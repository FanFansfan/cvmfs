%post

export RUNNER_LOG_DIR=/var/log/cvmfs-gateway

if [ x"$(which systemctl)" != x"" ]; then
    echo "  - restarting rsyslog"
    systemctl restart rsyslog

    echo "  - installing systemd service file"
    systemctl daemon-reload
else
    echo "  - restarting rsyslog"
    service rsyslog restart
fi

# Setup Mnesia
echo "Setting up the Mnesia"

cvmfs_mnesia_root=/var/lib/cvmfs-gateway
echo "  - (re)creating schema directory at $cvmfs_mnesia_root"
rm -rf $cvmfs_mnesia_root && sudo mkdir -p $cvmfs_mnesia_root

echo "  - creating Mnesia schema"
/usr/libexec/cvmfs-gateway/bin/cvmfs_gateway escript scripts/setup_mnesia.escript $cvmfs_mnesia_root
